const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/views_dashboard-Bw5k6ehg.js","assets/vendor_vue-BGCJdS91.js","assets/vendor_others-61MiWlPN.js","assets/vendor_antd-CbM69jnB.js","assets/vendor_lodash-C-4aNVBM.js","assets/vendor_antd-B6snAd4S.css","assets/views_403.vue-DERl_Rat.js"])))=>i.map(i=>d[i]);
var T=Object.defineProperty;var b=(t,e,o)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var _=(t,e,o)=>b(t,typeof e!="symbol"?e+"":e,o);import{as as L,at as O,au as A,av as g,aw as M}from"./vendor_others-61MiWlPN.js";import{a as I,L as D,M as U,b as j,c as H,d as N,I as x,e as B,f as q,B as V,F as $,C as z}from"./vendor_antd-CbM69jnB.js";import{d as v,aU as K,f as E,aV as X,aT as P,aW as F,aS as c,k as a,H as S,aX as W,aY as Y,r as G,aQ as J}from"./vendor_vue-BGCJdS91.js";const Q=()=>{const t=L.create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});return t.interceptors.request.use(e=>{const o=l();return o.token&&(e.headers.Authorization=`Bearer ${o.token}`),e.headers["X-API-Version"]="v1",e}),t.interceptors.response.use(e=>Z(e),e=>ee(e)),t},Z=t=>{const e=t.data;return e.code!==200?Promise.reject(new Error(e.message||"Business Error")):e.data},ee=t=>{var o;return((o=t.response)==null?void 0:o.status)===401?(l().logout(),window.location.replace(`/login?redirect=${encodeURIComponent(window.location.pathname)}`),Promise.reject(new Error("会话已过期，请重新登录"))):t.code==="ECONNABORTED"?Promise.reject(new Error("请求超时，请检查网络")):(I.error(t.message||"Request failed"),Promise.reject(t))},te=Q(),oe=t=>te.post("/api/login",t);O.post("/api/login",async()=>A.json({code:200,data:{token:"mock-token",permissions:["dashboard:view"]}},{status:200}));const C={MEMORY_THRESHOLD:1e8,TIMEOUT:5e3,CONCURRENT_LOADS:3,routePreloadConfig:{Dashboard:{priority:1,timeout:3e3},ReportList:{priority:2,timeout:5e3}}},re=Object.keys(C.routePreloadConfig);class ne{constructor(e){_(this,"memoryThreshold");this.memoryThreshold=e}checkMemory(){if(!performance.memory)return!0;const{usedJSHeapSize:e,jsHeapSizeLimit:o}=performance.memory;return o-e>=this.memoryThreshold}checkNetwork(){const e=navigator.connection;return e?e.effectiveType!=="slow-2g"&&!e.saveData:!0}}class se{constructor(){_(this,"monitor");_(this,"config",C);this.monitor=new ne(this.config.MEMORY_THRESHOLD)}async preloadRoute(e,o){const n=performance.now();try{const u=w.resolve({name:e}).matched.flatMap(r=>Object.values(r.components??{}).filter(s=>typeof s=="function").map(s=>s()));return await Promise.race([Promise.all(u),new Promise((r,s)=>setTimeout(()=>s(new Error(`Timeout: ${e}`)),o))]),{success:!0,duration:performance.now()-n}}catch(i){return{success:!1,error:i instanceof Error?i:new Error("Unknown error"),duration:performance.now()-n}}}async preloadChunk(e,o){if(!this.monitor.checkMemory()){console.warn("[预加载] 内存不足，跳过当前批次");return}try{await Promise.all(e.map(n=>this.preloadRoute(n,o.timeout??this.config.TIMEOUT)))}catch(n){console.error("[预加载] 预加载失败",n)}}async smartPreload(e,o={}){if(!this.monitor.checkNetwork()){console.log("[预加载] 网络状况不佳，跳过预加载");return}const n=e.filter(r=>this.config.routePreloadConfig[r]).sort((r,s)=>this.config.routePreloadConfig[r].priority-this.config.routePreloadConfig[s].priority),i=[],u=o.concurrentLoads??this.config.CONCURRENT_LOADS;for(let r=0;r<n.length;r+=u)i.push(n.slice(r,r+u));for(const r of i)try{await this.preloadChunk(r,o)}catch(s){console.error("[预加载] 批次预加载失败",s)}}}const k=new se,ae=k.smartPreload.bind(k),ie=v({__name:"BasicLayout",setup(t){const e=K(),o=E(["1"]),n=[{key:"1",label:"舆情概览",path:"/dashboard"},{key:"2",label:"报告管理",path:"/reports"}],i=({item:u})=>{e.push(u.props.path)};return(u,r)=>{const s=D,p=U,h=j,f=X("router-view"),y=H,d=N;return P(),F(d,null,{default:c(()=>[a(s,null,{default:c(()=>r[1]||(r[1]=[S("InsightPulse 舆情分析系统")])),_:1}),a(d,null,{default:c(()=>[a(h,null,{default:c(()=>[a(p,{selectedKeys:o.value,"onUpdate:selectedKeys":r[0]||(r[0]=m=>o.value=m),items:n,onClick:i},null,8,["selectedKeys"])]),_:1}),a(y,null,{default:c(()=>[a(f)]),_:1})]),_:1})]),_:1})}}}),ce={path:"/dashboard",name:"Dashboard",component:()=>g(()=>import("./views_dashboard-Bw5k6ehg.js"),__vite__mapDeps([0,1,2,3,4,5])),meta:{requiresAuth:!0,permission:"dashboard:view",title:"舆情概览",preloadPriority:1}},ue=[{path:"/",component:ie,redirect:"/dashboard",children:[ce]}];function le(t=ue){t.forEach(e=>{w.addRoute(e)})}const l=M("auth",{state:()=>({token:localStorage.getItem("token"),permissions:[]}),getters:{isAuthenticated:t=>!!t.token},actions:{async login(t){try{const{data:e}=await oe(t);le(),await ae(re,{concurrentLoads:2,memoryThreshold:15e7}),this.token=e.token,this.permissions=e.permissions,localStorage.setItem("token",e.token)}catch(e){throw console.error("Login failed:",e),e}},logout(){this.token=null,this.permissions=[],localStorage.removeItem("token")}}});function R(t){return l().permissions.includes(t)}function me(t,e){console.error(`[Error] ${t}`,e)}function pe(t){return l().permissions?Array.isArray(t)?t.every(o=>R(o)):R(t):!1}function de(t){t.beforeEach(async e=>{const o=l(),{permission:n,requiresAuth:i}=e.meta;return n&&!(typeof n=="string"||Array.isArray(n))?(me(`路由 ${e.fullPath} 的 permission 配置错误，需为 string 或 string[]`),!1):i&&!o.isAuthenticated?{name:"Login",query:{redirect:e.fullPath}}:n&&!pe(n)?{name:"403"}:!0})}const w=W({history:Y(),routes:[{path:"/login",name:"Login",component:()=>g(()=>Promise.resolve().then(()=>fe),void 0),meta:{requiresAuth:!1,title:"用户登录"}},{path:"/403",name:"403",component:()=>g(()=>import("./views_403.vue-DERl_Rat.js"),__vite__mapDeps([6,3,2,1,4,5])),meta:{requiresAuth:!1,title:"403"}},{path:"/:pathMatch(.*)*",redirect:"/login"}]});de(w);const _e={class:"login-container"},he=v({__name:"index",setup(t){const e=G({username:"",password:""}),o=l(),n=E(!1),i=async()=>{n.value=!0;try{await o.login(e)}finally{n.value=!1}};return(u,r)=>{const s=x,p=B,h=q,f=V,y=$,d=z;return P(),J("div",_e,[a(d,{title:"系统登录",style:{width:"400px"}},{default:c(()=>[a(y,null,{default:c(()=>[a(p,{label:"用户名"},{default:c(()=>[a(s,{value:e.username,"onUpdate:value":r[0]||(r[0]=m=>e.username=m)},null,8,["value"])]),_:1}),a(p,{label:"密码"},{default:c(()=>[a(h,{value:e.password,"onUpdate:value":r[1]||(r[1]=m=>e.password=m)},null,8,["value"])]),_:1}),a(f,{type:"primary",onClick:i},{default:c(()=>r[2]||(r[2]=[S("登录")])),_:1})]),_:1})]),_:1})])}}}),fe=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"}));export{w as r};
