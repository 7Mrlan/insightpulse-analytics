const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/views_dashboard-SE2A5z3B.js","assets/vendor_vue-BPum2tGi.js","assets/vendor_others-CR-70a3h.js","assets/vendor_antd-uffvfnBG.js","assets/vendor_lodash-C-4aNVBM.js","assets/vendor_antd-B6snAd4S.css","assets/views_403.vue-CXMEmum0.js"])))=>i.map(i=>d[i]);
var L=Object.defineProperty;var O=(t,e,o)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var _=(t,e,o)=>O(t,typeof e!="symbol"?e+"":e,o);import{as as A,at as M,au as I,av as v,aw as D}from"./vendor_others-CR-70a3h.js";import{a as U,L as j,M as H,b as N,c as x,d as B,I as q,e as V,f as $,B as z,F as K,C as X}from"./vendor_antd-uffvfnBG.js";import{d as P,aU as F,f,aV as W,aT as S,aW as Y,aS as u,k as i,H as T,c as G,aX as J,aY as Q,r as Z,aQ as ee}from"./vendor_vue-BPum2tGi.js";const te=()=>{const t=A.create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});return t.interceptors.request.use(e=>{const o=l();return o.token&&(e.headers.Authorization=`Bearer ${o.token}`),e.headers["X-API-Version"]="v1",e}),t.interceptors.response.use(e=>oe(e),e=>re(e)),t},oe=t=>{const e=t.data;return e.code!==200?Promise.reject(new Error(e.message||"Business Error")):e.data},re=t=>{var o;return((o=t.response)==null?void 0:o.status)===401?(l().logout(),window.location.replace(`/login?redirect=${encodeURIComponent(window.location.pathname)}`),Promise.reject(new Error("会话已过期，请重新登录"))):t.code==="ECONNABORTED"?Promise.reject(new Error("请求超时，请检查网络")):(U.error(t.message||"Request failed"),Promise.reject(t))},ne=te(),se=t=>ne.post("/api/login",t);M.post("/api/login",async()=>I.json({code:200,data:{token:"mock-token",permissions:["dashboard:view"]}},{status:200}));const C={MEMORY_THRESHOLD:1e8,TIMEOUT:5e3,CONCURRENT_LOADS:3,routePreloadConfig:{Dashboard:{priority:1,timeout:3e3},ReportList:{priority:2,timeout:5e3}}},ae=Object.keys(C.routePreloadConfig);class ie{constructor(e){_(this,"memoryThreshold");this.memoryThreshold=e}checkMemory(){if(!performance.memory)return!0;const{usedJSHeapSize:e,jsHeapSizeLimit:o}=performance.memory;return o-e>=this.memoryThreshold}checkNetwork(){const e=navigator.connection;return e?e.effectiveType!=="slow-2g"&&!e.saveData:!0}}class ce{constructor(){_(this,"monitor");_(this,"config",C);this.monitor=new ie(this.config.MEMORY_THRESHOLD)}async preloadRoute(e,o){const n=performance.now();try{const c=w.resolve({name:e}).matched.flatMap(r=>Object.values(r.components??{}).filter(s=>typeof s=="function").map(s=>s()));return await Promise.race([Promise.all(c),new Promise((r,s)=>setTimeout(()=>s(new Error(`Timeout: ${e}`)),o))]),{success:!0,duration:performance.now()-n}}catch(a){return{success:!1,error:a instanceof Error?a:new Error("Unknown error"),duration:performance.now()-n}}}async preloadChunk(e,o){if(!this.monitor.checkMemory()){console.warn("[预加载] 内存不足，跳过当前批次");return}try{await Promise.all(e.map(n=>this.preloadRoute(n,o.timeout??this.config.TIMEOUT)))}catch(n){console.error("[预加载] 预加载失败",n)}}async smartPreload(e,o={}){if(!this.monitor.checkNetwork()){console.log("[预加载] 网络状况不佳，跳过预加载");return}const n=e.filter(r=>this.config.routePreloadConfig[r]).sort((r,s)=>this.config.routePreloadConfig[r].priority-this.config.routePreloadConfig[s].priority),a=[],c=o.concurrentLoads??this.config.CONCURRENT_LOADS;for(let r=0;r<n.length;r+=c)a.push(n.slice(r,r+c));for(const r of a)try{await this.preloadChunk(r,o)}catch(s){console.error("[预加载] 批次预加载失败",s)}}}const k=new ce,ue=k.smartPreload.bind(k),le=P({__name:"BasicLayout",setup(t){const e=F(),o=f(["1"]),n=[{key:"1",label:"舆情概览",path:"/dashboard"},{key:"2",label:"报告管理",path:"/reports"}],a=({item:c})=>{e.push(c.props.path)};return(c,r)=>{const s=j,d=H,h=N,y=W("router-view"),g=x,p=B;return S(),Y(p,null,{default:u(()=>[i(s,null,{default:u(()=>r[1]||(r[1]=[T("InsightPulse 舆情分析系统")])),_:1}),i(p,null,{default:u(()=>[i(h,null,{default:u(()=>[i(d,{selectedKeys:o.value,"onUpdate:selectedKeys":r[0]||(r[0]=m=>o.value=m),items:n,onClick:a},null,8,["selectedKeys"])]),_:1}),i(g,null,{default:u(()=>[i(y)]),_:1})]),_:1})]),_:1})}}}),me={path:"/dashboard",name:"Dashboard",component:()=>v(()=>import("./views_dashboard-SE2A5z3B.js"),__vite__mapDeps([0,1,2,3,4,5])),meta:{requiresAuth:!0,permission:"dashboard:view",title:"舆情概览",preloadPriority:1}},de=[{path:"/",component:le,redirect:"/dashboard",children:[me]}];function R(t=de){t.forEach(e=>{w.addRoute(e)})}function b(t,e){console.error(`[Error] ${t}`,e)}const l=D("auth",()=>{const t=f(localStorage.getItem("token")),e=f([]),o=G(()=>!!t.value);async function n(r){try{const{data:s}=await se(r);t.value=s.token,e.value=s.permissions,localStorage.setItem("token",s.token),R(),await ue(ae,{concurrentLoads:2,memoryThreshold:15e7})}catch(s){throw b("Login failed",s),s}}function a(){t.value=null,e.value=[],localStorage.removeItem("token")}function c(){const r=localStorage.getItem("token");r&&(t.value=r,R())}return{token:t,permissions:e,isAuthenticated:o,login:n,logout:a,initAuth:c}},{persist:{pick:["token"]}});function E(t){return l().permissions.includes(t)}function pe(t){return l().permissions?Array.isArray(t)?t.every(o=>E(o)):E(t):!1}function _e(t){t.beforeEach(async e=>{const o=l(),{permission:n,requiresAuth:a}=e.meta;return n&&!(typeof n=="string"||Array.isArray(n))?(b(`路由 ${e.fullPath} 的 permission 配置错误，需为 string 或 string[]`),!1):a&&!o.isAuthenticated?{name:"Login",query:{redirect:e.fullPath}}:n&&!pe(n)?{name:"403"}:!0})}const w=J({history:Q(),routes:[{path:"/login",name:"Login",component:()=>v(()=>Promise.resolve().then(()=>ye),void 0),meta:{requiresAuth:!1,title:"用户登录"}},{path:"/403",name:"403",component:()=>v(()=>import("./views_403.vue-CXMEmum0.js"),__vite__mapDeps([6,3,2,1,4,5])),meta:{requiresAuth:!1,title:"403"}},{path:"/:pathMatch(.*)*",redirect:"/login"}]});_e(w);const fe={class:"login-container"},he=P({__name:"index",setup(t){const e=Z({username:"",password:""}),o=l(),n=f(!1),a=async()=>{n.value=!0;try{await o.login(e)}finally{n.value=!1}};return(c,r)=>{const s=q,d=V,h=$,y=z,g=K,p=X;return S(),ee("div",fe,[i(p,{title:"系统登录",style:{width:"400px"}},{default:u(()=>[i(g,null,{default:u(()=>[i(d,{label:"用户名"},{default:u(()=>[i(s,{value:e.username,"onUpdate:value":r[0]||(r[0]=m=>e.username=m)},null,8,["value"])]),_:1}),i(d,{label:"密码"},{default:u(()=>[i(h,{value:e.password,"onUpdate:value":r[1]||(r[1]=m=>e.password=m)},null,8,["value"])]),_:1}),i(y,{type:"primary",onClick:a},{default:u(()=>r[2]||(r[2]=[T("登录")])),_:1})]),_:1})]),_:1})])}}}),ye=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"}));export{w as r,l as u};
